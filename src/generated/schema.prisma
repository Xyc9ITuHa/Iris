generator client {
  provider = "prisma-client-js"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model manufacturers {
  id            Int       @id @default(autoincrement())
  name          String
  country       String?
  website       String?
  created_at    DateTime?
  contact_email String?
  updated_at    DateTime?
  lasers        lasers[]

  @@map("manufacturers")
}

model lasers {
  id                  Int                  @id @default(autoincrement())
  model_name          String
  manufacturer_id     Int
  notes               String?
  created_at          DateTime?
  updated_at          DateTime?
  application         String?
  cooling_method      String?
  is_single_mode      Boolean
  laser_type          String
  modulation_type     String
  power_consumption_w Decimal?
  power_output_w      Decimal
  environmental_specs environmental_specs?
  manufacturer        manufacturers        @relation(fields: [manufacturer_id], references: [id])
  optical_specs       optical_specs?
  pulse_specs         pulse_specs?
  stability_specs     stability_specs?
  wavelength_specs    wavelength_specs?

  @@map("lasers")
}

model wavelength_specs {
  id                            Int       @id @default(autoincrement())
  laser_id                      Int       @unique
  wavelength_base_nm            Decimal
  wavelength_tolerance_nm       Decimal?
  bandwidth_nm                  Decimal?
  fwhm_nm                       Decimal?
  wavelength_stability_nm_per_c Decimal?
  wavelength_tuning_range       String?
  created_at                    DateTime?
  updated_at                    DateTime?
  laser                         lasers    @relation(fields: [laser_id], references: [id])

  @@map("wavelength_specs")
}

model optical_specs {
  id                    Int       @id @default(autoincrement())
  laser_id              Int       @unique
  beam_divergence_mrad  Decimal?
  beam_quality_m2       Decimal?
  aperture_mm           Decimal?
  numerical_aperture    Decimal?
  polarization          String?
  polarization_ratio_db Decimal?
  created_at            DateTime?
  laser                 lasers    @relation(fields: [laser_id], references: [id])

  @@map("optical_specs")
}

model stability_specs {
  id                      Int       @id @default(autoincrement())
  laser_id                Int       @unique
  power_stability_percent Decimal?
  pointing_stability_urad Decimal?
  temperature_stability_c Decimal?
  warmup_time_min         Decimal?
  created_at              DateTime?
  laser                   lasers    @relation(fields: [laser_id], references: [id])

  @@map("stability_specs")
}

model environmental_specs {
  id                   Int       @id @default(autoincrement())
  laser_id             Int       @unique
  operating_temp_min_c Decimal?
  operating_temp_max_c Decimal?
  storage_temp_min_c   Decimal?
  storage_temp_max_c   Decimal?
  humidity_max_percent Decimal?
  protection_class     String?
  created_at           DateTime?
  laser                lasers    @relation(fields: [laser_id], references: [id])

  @@map("environmental_specs")
}

model pulse_specs {
  id                 Int       @id @default(autoincrement())
  laser_id           Int       @unique
  pulse_width_ns     Decimal?
  pulse_energy_j     Decimal?
  rep_rate_hz        Decimal?
  duty_cycle_percent Decimal?
  rise_time_ns       Decimal?
  fall_time_ns       Decimal?
  created_at         DateTime?
  laser              lasers    @relation(fields: [laser_id], references: [id])

  @@map("pulse_specs")
}

model users {
  id                         Int                @id @default(autoincrement())
  email                      String             @unique
  password_hash              String
  name                       String
  is_active                  Boolean            @default(true)
  created_at                 DateTime?
  updated_at                 DateTime?
  last_login                 DateTime?
  role                       String
  access_codes               access_codes[]
  audit_log                  audit_log[]
  pending_actions_approved   pending_actions[]  @relation("approved_by_rel")
  pending_actions_initiated  pending_actions[]  @relation("initiated_by_rel")
  rollback_history_approved  rollback_history[] @relation("rollback_approved_rel")
  rollback_history_initiated rollback_history[] @relation("rollback_initiated_rel")

  @@map("users")
}

model access_codes {
  id           Int       @id @default(autoincrement())
  code_hash    String
  color_code   String
  created_by   Int
  expires_at   DateTime?
  max_uses     Int?
  current_uses Int       @default(0)
  is_active    Boolean   @default(true)
  notes        String?
  created_at   DateTime?
  role         String
  creator      users     @relation(fields: [created_by], references: [id])

  @@map("access_codes")
}

model audit_log {
  id               Int                @id @default(autoincrement())
  user_id          Int?
  table_name       String
  record_id        Int?
  old_data         Json?
  new_data         Json?
  ip_address       String?
  created_at       DateTime?
  action           String
  user             users?             @relation(fields: [user_id], references: [id])
  rollback_history rollback_history[]

  @@index([table_name, record_id])
  @@index([user_id])
  @@index([created_at])
  @@map("audit_log")
}

model pending_actions {
  id               Int       @id @default(autoincrement())
  initiated_by     Int
  target_table     String
  target_record_id Int?
  action_data      Json?
  reason           String?
  expires_at       DateTime?
  approved_by      Int?
  approved_at      DateTime?
  completed_at     DateTime?
  created_at       DateTime?
  action_type      String
  status           String    @default("pending")
  approver         users?    @relation("approved_by_rel", fields: [approved_by], references: [id])
  initiator        users     @relation("initiated_by_rel", fields: [initiated_by], references: [id])

  @@map("pending_actions")
}

model rollback_history {
  id            Int       @id @default(autoincrement())
  audit_log_id  Int
  initiated_by  Int
  approved_by   Int?
  error_message String?
  created_at    DateTime?
  status        String
  approver      users?    @relation("rollback_approved_rel", fields: [approved_by], references: [id])
  audit_log     audit_log @relation(fields: [audit_log_id], references: [id])
  initiator     users     @relation("rollback_initiated_rel", fields: [initiated_by], references: [id])

  @@map("rollback_history")
}
